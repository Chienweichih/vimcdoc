<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>VIM: if_ole</title>
<link rel="stylesheet" href="vim-stylesheet.css" type="text/css">
</head>
<body>
<div id=banner>
<a href="help.html">幫助總覽</a> &middot;
<a href="quickref.html">快速參考</a> &middot;
<a href="index.html">命令索引</a> &middot;
<a href="usr_toc.html">用戶手冊</a> &middot;
<a href="help.html#reference_toc">參考手冊</a>
</div>

<div id=outer>
<h2>if_ole</h2>
<pre>
<b class="vimtag"> <a name="if_ole.txt">if_ole.txt</a> </b>    For Vim version 8.0.  最近更新: 2017年7月


                  <code class="vim">VIM 參考手冊    by Paul Moore</code>
                                     <code class="vim">譯者</code>: Dasn
                                     http://vimcdoc.sf.net


Vim 的 OLE 接口                                         <b class="vimtag"> <a name="ole-interface">ole-interface</a> </b>

1. 激活 OLE 功能                 <a href="if_ole.html#ole-activation">ole-activation</a> 
2. 方法                          <a href="if_ole.html#ole-methods">ole-methods</a> 
3. "normal" 命令                 <a href="if_ole.html#ole-normal">ole-normal</a> 
4. 註冊                          <a href="if_ole.html#ole-registration">ole-registration</a> 
5. 與微軟的 Visual Studio 集成   <a href="if_ole.html#MSVisualStudio">MSVisualStudio</a> 

<code class="notvi">{Vi 沒有這些功能}</code>

OLE 只有在編譯時加入  <a href="various.html#+ole">+ole</a>  才可以使用。參見 src/if_ole.INSTALL。
有一點不同之處在於它使用 客戶機服務器 模式進行通信  <a href="remote.html#clientserver">clientserver</a> 。

</pre><hr class="doubleline" /><pre>
<h4>1. 激活 OLE 功能                                        <b class="vimtag"> <a name="ole-activation">ole-activation</a> </b></h4>
Vim 可以作為 OLE 服務器運行，能被任意的 OLE 客戶端訪問，例如: 我們可以用
Visual Basic，Python，或者 Perl 與 Vim 通信。Vim 的程序名 (在 OLE 中稱為
"ProgID") 是 "Vim.Application"。

因此，要啟動一個 Vim 實例 (或者要與一個已經啟動的實例通信)，你應該使用類似於下
面的代碼:

[Visual Basic] 
<code class="example">        Dim Vim As Object</code>
<code class="example">        Set Vim = CreateObject("Vim.Application")</code>
<code class="example"></code>
[Python] 
<code class="example">        from win32com.client.dynamic import Dispatch</code>
<code class="example">        vim = Dispatch('Vim.Application')</code>
<code class="example"></code>
[Perl] 
<code class="example">        use Win32::OLE;</code>
<code class="example">        $vim = new Win32::OLE 'Vim.Application';</code>
<code class="example"></code>
[C#] 
<code class="example">        // 在項目中加入 Vim 的引用。</code>
<code class="example">        // 選擇 COM 標籤頁。</code>
<code class="example">        // 選擇 "Vim Ole Interface 1.1 Type Library"</code>
<code class="example">        Vim.Vim vimobj = new Vim.Vim();</code>
<code class="example"></code>
Vim 不能作為 "隱藏" 的 OLE 服務器來運行，這一點 Vim 不像其它一些 OLE 服務器。
Vim 的 OLE 客戶端啟動時，一個 Vim 程序的實例會立刻顯現出來。簡單地斷開 OLE 連
接不能關掉 Vim 實例，需要顯式地執行退出命令才可以 (例如，:qa!，:wqa)。

</pre><hr class="doubleline" /><pre>
<h4>2. 方法                                                 <b class="vimtag"> <a name="ole-methods">ole-methods</a> </b></h4>
Vim 為客戶端提供了四種方法。

                                                        <b class="vimtag"> <a name="ole-sendkeys">ole-sendkeys</a> </b>
SendKeys(keys)          執行一系列鍵擊。

這個函數只需要一個參數，參數 keys 代表要敲擊的字符串。通過此函數發送這些字符串
和你直接在 Vim 裡敲擊鍵盤的效果是一樣的。特殊鍵可以用它們的 &lt;..&gt; 名字，就像映
射的右手邊裡的格式一樣 (參考  <a href="map.html#:map">:map</a>  特殊鍵的表達方式<code class="vim">譯者</code>)。<code class="note">備註</code>: 不支持 Ex 模
式下的 "normal" 命令  見下面  <a href="if_ole.html#ole-normal">ole-normal</a> 。

例子: (Visual Basic 語法) 
<code class="example">        Vim.SendKeys "ihello&lt;Esc&gt;"</code>
<code class="example">        Vim.SendKeys "ma1GV4jy`a"</code>
<code class="example"></code>
這個例子假設 Vim 處於普通模式，要強制進入普通模式，可以在字符序列前加入
<code class="keystroke">CTRL-\</code> <code class="keystroke">CTRL-N</code>，就像這樣: 
<code class="example"></code>
<code class="example">        Vim.SendKeys "&lt;C-\&gt;&lt;C-N&gt;ihello&lt;Esc&gt;"</code>
<code class="example"></code>
(<code class="vim">譯者注</code>: 下面是 Perl 語法:   
<code class="example"></code>
<code class="example">        $vim-&gt;SendKeys("&lt;C-\\&gt;&lt;C-N&gt;ihello&lt;Esc&gt;");</code>

        <code class="note">備註</code>: 在 Perl 語法裡，特殊字符前需要加 "\"。)

<code class="keystroke">CTRL-\</code> <code class="keystroke">CTRL-N</code> 使得 Vim 從插入模式或命令行模式返回普通模式。
<code class="note">備註</code>: 不能用這個命令發送 Vim 命令的一部分。
                                                        <b class="vimtag"> <a name="ole-eval">ole-eval</a> </b>
Eval(expr)              計算表達式的值。

函數只有一個參數 expr，Vim 正常格式的表達式 (參考  <a href="eval.html#expression">expression</a> )。返回值是一個
包含表達式結果的字符串。 <a href="eval.html#List">List</a>  通過連接項目並插入換行符以轉化為字符串。

例子: (Visual Basic 語法) 
<code class="example"></code>
<code class="example">        Line20 = Vim.Eval("getline(20)")</code>
<code class="example">        Twelve = Vim.Eval("6 + 6")              ' 注意，這是一個字符串。</code>
<code class="example">        Font = Vim.Eval("&amp;guifont")</code>

                                                        <b class="vimtag"> <a name="ole-setforeground">ole-setforeground</a> </b>
SetForeground()         讓 Vim 窗口轉入前台工作。

這個函數沒有參數，沒有返回值。

例子: (Visual Basic 語法) 
<code class="example"></code>
<code class="example">        Vim.SetForeground</code>

                                                        <b class="vimtag"> <a name="ole-gethwnd">ole-gethwnd</a> </b>
GetHwnd()       返回 Vim 窗口的句柄。

這個函數沒有參數，它返回 Vim 主窗口的句柄。你可以用它來控制 Vim 窗口，或者跟蹤
窗口的 z-深度 等位置。

例子: (Visual Basic 語法) 
<code class="example"></code>
<code class="example">        Vim_Hwnd = Vim.GetHwnd</code>


</pre><hr class="doubleline" /><pre>
<h4>3. "normal" 命令                                        <b class="vimtag"> <a name="ole-normal">ole-normal</a> </b></h4>
因為 Vim 是通過 Ex 模式下的 :normal 命令來實現對 OLE 命令的處理，所以 Vim 不能
通過 OLE 執行 :normal 命令。如果你這樣做，肯定沒用。至於產生的結果，也許沒什麼
害處，也許不能預料。

現在沒有辦法能捕獲這種錯誤，所以用戶在使用的時候要<code class="note">注意</code>有這麼一個限制。
</pre><hr class="doubleline" /><pre>
<h4>4. 註冊                                         <b class="vimtag"> <a name="ole-registration">ole-registration</a> </b> <b class="vimtag"> <a name="E243">E243</a> </b></h4>
在 Vim 作為 OLE 服務器運行之前，必須向系統註冊。如果你想註冊，可以在運行 Vim
的時候加一個參數 "-register"。
                                                        <b class="vimtag"> <a name="-register">-register</a> </b>  
<code class="example">        gvim -register</code>
<code class="example"></code>
如果運行 OLE 版本的 gvim 時，Vim 的 OLE 服務沒有註冊，gvim 會彈出一個對話框，
讓你選擇是否註冊，選擇 "Yes" 註冊。

有時候可能註冊不會成功，這可能是因為註冊表不可寫。如果是這個原因，你需要以管理
員的身份來運行 gvim。

一旦註冊，Vim 的路徑就會被存儲到註冊表裡。在你移動、刪除或升級 Vim 之前，應該
使用 "-unregister" 清除這些註冊信息。
                                                        <b class="vimtag"> <a name="-unregister">-unregister</a> </b>  
<code class="example">        gvim -unregister</code>
<code class="example"></code>
系統會使用最先註冊的 Vim 執行 OLE 命令。如果 Vim 已經運行，那麼就使用當前運行
的 Vim。如果你不想讓 (多個) Vim 響應 OLE 命令，請使用非 OLE 版本的 Vim，並且把
它放到別的目錄裡。這時，OLE 版本的 Vim 路徑不應包含在你的正常路徑裡，這樣當你
鍵入 "gvim" 時啟動的才是非 OLE 版本。

                                                        <b class="vimtag"> <a name="-silent">-silent</a> </b>
如果不想讓 Vim 在註冊時彈出對話框，可以在前面加 "-silent" 參數:

<code class="example">        gvim -silent -register</code>
<code class="example">        gvim -silent -unregister</code>
<code class="example"></code>
</pre><hr class="doubleline" /><pre>
<h4>5. 與微軟的 Visual Studio 集成                  <b class="vimtag"> <a name="MSVisualStudio">MSVisualStudio</a> </b> <b class="vimtag"> <a name="VisVim">VisVim</a> </b></h4>
Vim 的 OLE 版本可以用做 Visual Studio 的文本編輯器。這被稱作 "VisVim"。OLE 版
本的軟件包裡有一個 runtime 目錄，詳細的說明請參閱該目錄下的 README_VisVim.txt
文件。


<code class="section">在 Visual Studio .Net 裡使用 Vim </code>

.Net 裡不再需要 VisVim 了，因為 .Net Studio 已經提供了外部編輯器的支持。按以下
步驟進行:

在 .Net Studio 裡，選擇菜單 Tools-&gt;External Tools...
加入
     Title     - Vim
     Command   - c:\vim\vim63\gvim.exe
     Arguments - --servername VS_NET --remote-silent "+call cursor($(CurLine), $(CurCol))" $(ItemPath)
     Init Dir  - 空

現在在 .Net 裡打開文件時，可以在 .Net 菜單裡選擇: Tools-&gt;Vim

這樣就能在 Vim 裡打開文件。
可以把該外部命令作為圖標加入，把它放在任何你喜歡的位置上。也可以把它設為你的缺
省編輯器。

如果你有進一步的改進，請到 Vim 郵件列表上發帖，以告知我們。

--servername VS_NET
建立 vim 的新實例，名為 VS_NET。這樣如果你從 VS 裡打開多個文件，它們會使用相同
的 Vim 實例。這樣，你可以運行多個 Vim 的備份，但可以控制在哪個裡編輯 VS 文件。

--remote-silent "+call cursor(10, 27)"
              - 把光標放在第 10 行第 27 列
Vim 裡 
<code class="example">   :h --remote-silent 可以瞭解詳情</code>
<code class="example"></code>
[.Net 的評注由 Dave Fishburn 和 Brian Sturk 提供]

</pre><hr class="doubleline" /><pre>
<h4> vim:tw=78:ts=8:ft=help:norl:</h4>
</pre>
<p><i>Generated by vim2html</i></p>
</div>
</body>
</html>
