<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>VIM: if_perl</title>
<link rel="stylesheet" href="vim-stylesheet.css" type="text/css">
</head>
<body>
<div id=banner>
<a href="help.html">幫助總覽</a> &middot;
<a href="quickref.html">快速參考</a> &middot;
<a href="index.html">命令索引</a> &middot;
<a href="usr_toc.html">用戶手冊</a> &middot;
<a href="help.html#reference_toc">參考手冊</a>
</div>

<div id=outer>
<h2>if_perl</h2>
<pre>
<b class="vimtag"> <a name="if_perl.txt">if_perl.txt</a> </b>   For Vim version 8.0.  最近更新: 2017年7月


                  <code class="vim">VIM 參考手冊    by Sven Verdoolaege</code>
                                         and Matt Gerassimof
                            <code class="vim">譯者</code>: foolstone@ustc.edu，Willis，tocer
                            http://vimcdoc.sf.net


Perl 與 Vim                                             <b class="vimtag"> <a name="perl">perl</a> </b> <b class="vimtag"> <a name="Perl">Perl</a> </b>

1. 編輯 Perl 文檔                <a href="if_perl.html#perl-editing">perl-editing</a> 
2. 編譯帶 Perl 接口的 Vim        <a href="if_perl.html#perl-compiling">perl-compiling</a> 
3. Perl 接口的使用               <a href="if_perl.html#perl-using">perl-using</a> 
4. 動態調入                      <a href="if_perl.html#perl-dynamic">perl-dynamic</a> 

<code class="notvi">{Vi 沒有上述這些功能}</code>
Perl 接口只有在編譯 Vim 時加入  <a href="various.html#+perl">+perl</a>  才能使用。

</pre><hr class="doubleline" /><pre>
<h4>1. 編輯 Perl 文件                                       <b class="vimtag"> <a name="perl-editing">perl-editing</a> </b></h4>
Vim 語法高亮顯示支持 Perl 和 POD 文件。Vim 假設後綴為 .pl 和 .pm 的文件是 Perl
文件。Vim 同時不管文件後綴而測試文件的首行來檢查一個文件是否為 Perl 腳本 (參見
Vim 的 syntax 目錄下的 scripts.vim)。Vim 假設帶後綴 .POD 的文件是 POD 文本。

要使用 Perl 標籤，你需要 Exuberant ctags 的最新版本。在這裡可以找到它:
        http://ctags.sourceforge.net

當然，作為選擇你還可以用一個叫 pltags.pl 的 Perl 腳本，它和 Vim 一起發行的，位
於 $VIMRUNTIME/tools 目錄下。這個腳本比 Exuberant ctags 的 Perl 支持具備更多的
功能。

</pre><hr class="doubleline" /><pre>
<h4>2. 編譯帶 Perl 接口的 Vim                               <b class="vimtag"> <a name="perl-compiling">perl-compiling</a> </b></h4>
為了編譯帶 Perl 接口的 Vim，需要 Perl 5.004 (或者更新) 的版本。Perl 必須在你編
譯 Vim 前安裝。 Vim 的 Perl 接口 <code class="emphasis">不能</code> 和官方發行的 Perl 5.003 一起正常工作！它
也許能和 Perl 5.003_05 或者更新版本一起正常工作。
_[<code class="vim">譯者注</code>]到翻譯的時候，這個問題已經不會是大問題了_

Vim 的 Perl 補丁由
        Sven Verdoolaege&lt;skimo@breughel.ufsia.ac.be&gt; 和
        Matt Gerassimof
製作。

Perl 的 MS-Windows 版本可以在下面這個網址找到: http://www.perl.com/
ActiveState 的版本應該可用。

</pre><hr class="doubleline" /><pre>
<h4>3. Perl 接口的使用                                      <b class="vimtag"> <a name="perl-using">perl-using</a> </b></h4>
                                                        <b class="vimtag"> <a name=":perl">:perl</a> </b> <b class="vimtag"> <a name=":pe">:pe</a> </b>
:pe[rl] <code class="special">{cmd}</code>           執行 Perl 命令 <code class="special">{cmd}</code>。當前包是 "main"。測試  <a href="if_perl.html#:perl">:perl</a>  是
                        否可用的簡單例子: 
<code class="example">                                :perl VIM::Msg("Hello")</code>
<code class="example"></code>
:pe[rl] &lt;&lt; <code class="special">{endpattern}</code>
<code class="special">{script}</code>
<code class="special">{endpattern}</code>
                        執行 Perl 腳本 <code class="special">{script}</code>。
                        <code class="special">{endpattern}</code>  <code class="emphasis">不能</code> 有任何前導空格。如果忽略了
                        <code class="special">{endpattern}</code>，就會像  <a href="insert.html#:append">:append</a>  和  <a href="insert.html#:insert">:insert</a>  命令那樣，
                        默認為點 '.'。在函數內使用時，最好指明 '.'，因為 "$i;"
                        看起來像 Vim 的  <a href="insert.html#:insert">:insert</a>  命令的開始。
                         <a href="if_perl.html#:perl">:perl</a>  命令的這種形式主要是用來在 vim 腳本裡面包含
                        perl 代碼。
                        <code class="note">備註</code>: 當 Perl 特性沒有被編譯進 vim 時這條命令不能工
                        作。為了避免出錯，請參考  <a href="if_perl.html#script-here">script-here</a> 。
vim 腳本示例: 
<code class="example"></code>
<code class="example">        function! WhitePearl()</code>
<code class="example">        perl &lt;&lt; EOF</code>
<code class="example">                VIM::Msg("pearls are nice for necklaces");</code>
<code class="example">                VIM::Msg("rubys for rings");</code>
<code class="example">                VIM::Msg("pythons for bags");</code>
<code class="example">                VIM::Msg("tcls????");</code>
<code class="example">        EOF</code>
<code class="example">        endfunction</code>

要看運行的 Perl 的版本: 
<code class="example">        :perl print $^V</code>


                                                        <b class="vimtag"> <a name=":perldo">:perldo</a> </b> <b class="vimtag"> <a name=":perld">:perld</a> </b>
:<code class="special">[range]</code>perld[o] <code class="special">{cmd}</code>  對 <code class="special">[range]</code> 中的每行執行 Perl 命令 <code class="special">{cmd}</code>，同時 $_ 依次
                        被賦值為每行的文本，但不包括行尾的 <code class="special">&lt;EOL&gt;</code>。改變 $_ 會改
                        變每行的內容，但<code class="note">注意</code>不能用這個命令添加或者刪除行。
                        <code class="special">[range]</code> 的缺省值是整個文件: "1，$"。

可以試一下下面的代碼: 
<code class="example"></code>
<code class="example">  :perl $a=1</code>
<code class="example">  :perldo $_ = reverse($_);1</code>
<code class="example">  :perl VIM::Msg("hello")</code>
<code class="example">  :perl $line = $curbuf-&gt;Get(42)</code>


                                                        <b class="vimtag"> <a name="E299">E299</a> </b>
在沙盤  <a href="eval.html#sandbox">sandbox</a>  裡執行 Perl 命令是受限制的。":perldo" 根本就不能執行。如果可
能，":perl" 會在安全環境下被執行。

                                                        <b class="vimtag"> <a name="perl-overview">perl-overview</a> </b>
下面是在 Perl 下可用的函數概要: 
<code class="example"></code>
<code class="example">  :perl VIM::Msg("Text")                # 顯示信息</code>
<code class="example">  :perl VIM::Msg("Error", "ErrorMsg")   # 顯示錯誤信息</code>
<code class="example">  :perl VIM::Msg("remark", "Comment")   # 顯示高亮的信息</code>
<code class="example">  :perl VIM::SetOption("ai")            # 設定一個 vim 選項</code>
<code class="example">  :perl $nbuf = VIM::Buffers()          # 返回緩衝區的個數</code>
<code class="example">  :perl @buflist = VIM::Buffers()       # 返回所有緩衝區的數組</code>
<code class="example">  :perl $mybuf = (VIM::Buffers('qq.c'))[0] # 返回一個 'qq.c' 的緩衝區對像</code>
<code class="example">  :perl @winlist = VIM::Windows()       # 返回所有窗口的數組</code>
<code class="example">  :perl $nwin = VIM::Windows()          # 返回窗口的個數</code>
<code class="example">  :perl ($success, $v) = VIM::Eval('&amp;path') # $v: 'path' 選項值，$success: 1</code>
<code class="example">  :perl ($success, $v) = VIM::Eval('&amp;xyz')  # $v: '' 而 $success: 0</code>
<code class="example">  :perl $v = VIM::Eval('expand("&lt;cfile&gt;")') # 展開文件 &lt;cfile&gt;</code>
<code class="example">  :perl $curwin-&gt;SetHeight(10)          # 設定窗口高度</code>
<code class="example">  :perl @pos = $curwin-&gt;Cursor()        # 返回坐標 (row，col) 數組</code>
<code class="example">  :perl @pos = (10, 10)</code>
<code class="example">  :perl $curwin-&gt;Cursor(@pos)           # 把光標位置設為 @pos</code>
<code class="example">  :perl $curwin-&gt;Cursor(10,10)          # 把光標位置設為第 10 行第 10 列</code>
<code class="example">  :perl $mybuf = $curwin-&gt;Buffer()      # 返回窗口的緩衝區對像</code>
<code class="example">  :perl $curbuf-&gt;Name()                 # 返回緩衝區名字</code>
<code class="example">  :perl $curbuf-&gt;Number()               # 返回緩衝區編號</code>
<code class="example">  :perl $curbuf-&gt;Count()                # 返回行數</code>
<code class="example">  :perl $l = $curbuf-&gt;Get(10)           # 返回第 10 行</code>
<code class="example">  :perl @l = $curbuf-&gt;Get(1 .. 5)       # 返回第 1 到第 5 行</code>
<code class="example">  :perl $curbuf-&gt;Delete(10)             # 刪除第 10 行</code>
<code class="example">  :perl $curbuf-&gt;Delete(10, 20)         # 刪除第 10－20 行</code>
<code class="example">  :perl $curbuf-&gt;Append(10, "Line")     # 添加一行</code>
<code class="example">  :perl $curbuf-&gt;Append(10, "Line1", "Line2", "Line3") # 添加三行</code>
<code class="example">  :perl @l = ("L1", "L2", "L3")</code>
<code class="example">  :perl $curbuf-&gt;Append(10, @l)         # 添加 L1，L2 和 L3</code>
<code class="example">  :perl $curbuf-&gt;Set(10, "Line")        # 替換第 10 行</code>
<code class="example">  :perl $curbuf-&gt;Set(10, "Line1", "Line2")      # 替換第 10 行和第 11 行</code>
<code class="example">  :perl $curbuf-&gt;Set(10, @l)            # 分別用 L1，L2 和 L3 替換 10－12 行</code>

                                                        <b class="vimtag"> <a name="perl-Msg">perl-Msg</a> </b>
VIM::Msg(<code class="special">{msg}</code>, <code class="special">{group}</code>?)
                        顯示消息 <code class="special">{msg}</code>。可選 <code class="special">{group}</code> 參數指定用來顯示這個消息
                        的高亮方式。

                                                        <b class="vimtag"> <a name="perl-SetOption">perl-SetOption</a> </b>
VIM::SetOption(<code class="special">{arg}</code>)
                        設置一個 vim 選項。<code class="special">{arg}</code> 可以是任何 ":set" 命令能接受
                        的參數。這就意味著參數里面不允許有空格！見  <a href="options.html#:set">:set</a> 。

                                                        <b class="vimtag"> <a name="perl-Buffers">perl-Buffers</a> </b>
VIM::Buffers([<code class="special">{bn}</code>...]) 沒有參數的時候，在數組上下文裡面返回所有緩衝區的列表，
                        在標量上下文裡返回緩衝區的個數。對於一個緩衝區名字或者
                        編號的列表 <code class="special">{bn}</code>，返回匹配 <code class="special">{bn}</code> 的緩衝區列表，與 Vim 內
                        部函數  <a href="eval.html#bufname()">bufname()</a>  使用同樣的規則。
                        警告: 使用  <a href="windows.html#:bwipe">:bwipe</a>  後，該列表就不合法了。如果要強行使
                        用會使 Vim 崩潰。

                                                        <b class="vimtag"> <a name="perl-Windows">perl-Windows</a> </b>
VIM::Windows([<code class="special">{wn}</code>...]) 沒有參數的時候，在數組上下文裡面返回所有窗口的列表，在
                        標量上下文裡返回窗口的個數。對於一個窗口編號的列表
                        <code class="special">{wn}</code>，返回匹配 <code class="special">{wn}</code> 的窗口列表。
                        警告: 窗口關閉後，該列表就不合法了。如果要強行使用會使
                        Vim 崩潰。

                                                        <b class="vimtag"> <a name="perl-DoCommand">perl-DoCommand</a> </b>
VIM::DoCommand(<code class="special">{cmd}</code>)   執行 Ex 命令 <code class="special">{cmd}</code>。

                                                        <b class="vimtag"> <a name="perl-Eval">perl-Eval</a> </b>
VIM::Eval(<code class="special">{expr}</code>)       對 <code class="special">{expr}</code> 求值並在列表上下文返回 (success，value)，在
                        標量上下文則只返回 value。
                        success=1 表示 val 包含 <code class="special">{expr}</code> 的值。success=0 表示表
                        達式求值失敗。 '@x' 返回寄存器 x 的內容， '&amp;x' 返回選
                        項 x 的值，'x' 返回內部變量 x 的值，'$x' 等價於 perl
                        中的 $ENV<code class="special">{x}</code>。所有在命令行可以訪問的函數都可用於
                        <code class="special">{expr}</code>。
                        列表  <a href="eval.html#List">List</a>  通過連接項目並在項目間插入換行符來轉化為字
                        符串。

                                                        <b class="vimtag"> <a name="perl-SetHeight">perl-SetHeight</a> </b>
Window-&gt;SetHeight(<code class="special">{height}</code>)
                        把窗口的高度設定為 <code class="special">{height}</code>，不超過屏幕範圍。

                                                        <b class="vimtag"> <a name="perl-GetCursor">perl-GetCursor</a> </b>
Window-&gt;Cursor(<code class="special">{row}</code>?, <code class="special">{col}</code>?)
                        在沒有參數的情況下，返回窗口光標所處位置的坐標 (row，
                        col) 數組。當有參數 <code class="special">{row}</code> 和 <code class="special">{col}</code> 的情況下，把窗口光
                        標的位置設為 <code class="special">{row}</code> 和 <code class="special">{col}</code>。<code class="note">注意</code> <code class="special">{col}</code> 是按 Perl 風格
                        從0 數起的，比 Vim 的尺度小 1。

Window-&gt;Buffer()                                        <b class="vimtag"> <a name="perl-Buffer">perl-Buffer</a> </b>
                        返回給定窗口的緩衝區對象。

                                                        <b class="vimtag"> <a name="perl-Name">perl-Name</a> </b>
Buffer-&gt;Name()          返回緩衝區的文件名。

                                                        <b class="vimtag"> <a name="perl-Number">perl-Number</a> </b>
Buffer-&gt;Number()        返回緩衝區的編號。

                                                        <b class="vimtag"> <a name="perl-Count">perl-Count</a> </b>
Buffer-&gt;Count()         返回緩衝區中的行數。

                                                        <b class="vimtag"> <a name="perl-Get">perl-Get</a> </b>
Buffer-&gt;Get(<code class="special">{lnum}</code>, <code class="special">{lnum}</code>?, ...)
                        對每個指定的 <code class="special">{lnum}</code>，返回緩衝區中第 <code class="special">{lnum}</code> 行的文本字
                        符串。通過指定一個 <code class="special">{lnum}</code> 列表可以傳遞一個數組。

                                                        <b class="vimtag"> <a name="perl-Delete">perl-Delete</a> </b>
Buffer-&gt;Delete(<code class="special">{lnum}</code>, <code class="special">{lnum}</code>?)
                        刪除緩衝區的第 <code class="special">{lnum}</code> 行。當有第二個參數 <code class="special">{lnum}</code> 時，刪
                        除由第一個 <code class="special">{lnum}</code> 到第二個 <code class="special">{lnum}</code> 指定的範圍。

                                                        <b class="vimtag"> <a name="perl-Append">perl-Append</a> </b>
Buffer-&gt;Append(<code class="special">{lnum}</code>, <code class="special">{line}</code>, <code class="special">{line}</code>?, ...)
                        把每個 <code class="special">{line}</code> 字符串添加到緩衝區的第 <code class="special">{lnum}</code> 行後面。
                        <code class="special">{line}</code> 列表可以是一個數組。

                                                        <b class="vimtag"> <a name="perl-Set">perl-Set</a> </b>
Buffer-&gt;Set(<code class="special">{lnum}</code>, <code class="special">{line}</code>, <code class="special">{line}</code>?, ...)
                        替代緩衝區從第 <code class="special">{lnum}</code> 行開始，由 <code class="special">{line}</code> 指定的一行或者
                        多行。 <code class="special">{line}</code> 列表可以是一個數組。如果參數無效，就不作
                        替代。
$main::curwin
                        當前窗口對象。
$main::curbuf
                        當前緩衝區對象。

                                                        <b class="vimtag"> <a name="script-here">script-here</a> </b>
當使用嵌入式腳本語言時，你可能想在語言不支持時跳過這些語言的代碼。但是以下機制
不能工作: 
<code class="example">   if has('perl')</code>
<code class="example">     perl &lt;&lt; EOF</code>
<code class="example">       this will NOT work!</code>
<code class="example">   EOF</code>
<code class="example">   endif</code>
相反，應把 Perl / Python / Ruby 等的命令放在一個函數里面並調用它: 
<code class="example">    if has('perl')</code>
<code class="example">      function DefPerl()</code>
<code class="example">        perl &lt;&lt; EOF</code>
<code class="example">          this works</code>
<code class="example">    EOF</code>
<code class="example">      endfunction</code>
<code class="example">      call DefPerl()</code>
<code class="example">    endif</code>
<code class="note">備註</code>: "EOF" 必須在行首 (前面不能有前導空格)。

</pre><hr class="doubleline" /><pre>
<h4>4. 動態調入                                             <b class="vimtag"> <a name="perl-dynamic">perl-dynamic</a> </b></h4>
MS-Windows 和 Unix 上，可以動態調入 Perl 庫。 <a href="various.html#:version">:version</a>  輸出這時應包括
 <a href="various.html#+perl%2Fdyn">+perl/dyn</a> 。

這意味著 Vim 只有在必要時才尋找 Perl DLL 或共享庫文件。如果不使用 Perl 接口，
你就不需要它。這樣，即使沒有該文件，你也可使用 Vim。


<code class="section">MS-Windows </code>

你可以從 http://www.perl.org 下載 Perl。用於編譯 Vim 的是 ActiveState 提供的版
本。

要使用 Perl 接口，Perl DLL 必須在搜索路徑上。
如果 Vim 報告找不到 perl512.dll，確保 $PATH 包含該文件所在的路徑。Perl 安裝程
序通常會做好這一點。
控制台窗口裡輸入 "path" 可以看到 (搜索路徑) 當前使用的目錄。也可以用 <a href="options.html#'perldll'">'perldll'</a>
選項指定 Perl DLL。

DLL 名必須匹配 Vim 編譯時所使用的 Perl 版本。目前，該名字為 "perl512.dll"，也
就是 Perl 5.12。要確信這一點，編輯 "gvim.exe" 文件並查找 "perl\d*.dll\c"。


<code class="section">Unix </code>

<a href="options.html#'perldll'">'perldll'</a> 選項可用來指定 Perl 共享庫文件，而不用編譯時指定的 DYNAMIC_PERL_DLL
文件。共享庫的版本必須和 Vim 編譯使用的 Perl 版本保持一致。

</pre><hr class="doubleline" /><pre>
<h4> vim:tw=78:ts=8:ft=help:norl:</h4></pre>
<p><i>Generated by vim2html</i></p>
</div>
</body>
</html>
