<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>VIM: diff</title>
<link rel="stylesheet" href="vim-stylesheet.css" type="text/css">
</head>
<body>
<div id=banner>
<a href="help.html">幫助總覽</a> &middot;
<a href="quickref.html">快速參考</a> &middot;
<a href="index.html">命令索引</a> &middot;
<a href="usr_toc.html">用戶手冊</a> &middot;
<a href="help.html#reference_toc">參考手冊</a>
</div>

<div id=outer>
<h2>diff</h2>
<pre>
<b class="vimtag"> <a name="diff.txt">diff.txt</a> </b>      For Vim version 8.0.  最近更新: 2017年7月


                  <code class="vim">VIM 參考手冊    by Bram Moolenaar</code>
                   <code class="vim">譯者</code>: Zimin&lt;cranecai@users.sf.net&gt;, tocer
                   http://vimcdoc.sf.net


                                <b class="vimtag"> <a name="diff">diff</a> </b> <b class="vimtag"> <a name="vimdiff">vimdiff</a> </b> <b class="vimtag"> <a name="gvimdiff">gvimdiff</a> </b> <b class="vimtag"> <a name="diff-mode">diff-mode</a> </b>
這篇文章描述  <a href="various.html#+diff">+diff</a>  特性: 比較同一文件的兩到八個版本間的差異。

用戶手冊  <a href="usr_08.html#08.7">08.7</a>  節說明了一些比較基本的用法。

1. 進入比較模式                  <a href="diff.html#vimdiff">vimdiff</a> 
2. 查看比較結果                  <a href="diff.html#view-diffs">view-diffs</a> 
3. 跳轉到差異文                  <a href="diff.html#jumpto-diffs">jumpto-diffs</a> 
4. 複製差異文本                  <a href="diff.html#copy-diffs">copy-diffs</a> 
5. diff 選項                     <a href="diff.html#diff-options">diff-options</a> 

<code class="notvi">{Vi 無此功能}</code>

</pre><hr class="doubleline" /><pre>
<h4>1. 進入比較模式</h4>
進入比較模式編輯的最簡單方法就是用 "vimdiff" 命令。它如常啟動 Vim，但附加一些
設置，以便於查看輸入參數所指定的文件間的差異: 
<code class="example"></code>
<code class="example">        vimdiff file1 file2 [file3 [file4]]</code>
<code class="example"></code>
這等同於: 
<code class="example"></code>
<code class="example">        vim -d file1 file2 [file3 [file4]]</code>
<code class="example"></code>
你也可以使用 "gvimdiff" 或 "vim -d -g" 以啟動 GUI 的版本。
又或者，使用 "viewdiff" 或 "gviewdiff" 以啟動只讀模式。
"r" 可以附加在這些名字前面，用來進入受限模式 (參考  <a href="starting.html#-Z">-Z</a> )。

第二個及其後的參數也可以是目錄名。Vim 將依據第一個參數所指定的文件名在指定目錄
中查找另外的文件名。這一特性僅對標準的 "diff" 命令有效。參見 <a href="options.html#'diffexpr'">'diffexpr'</a>。

窗口比較局部於當前標籤頁  <a href="tabpage.html#tab-page">tab-page</a>  中。你不能看到某窗口和別的標籤頁中的窗口的
差異。這樣，可以同時打開多組比較窗口，每組差異在單獨的標籤頁中。

Vim 將為每個文件打開一個窗口，並且就像使用  <a href="starting.html#-O">-O</a>  參數一樣，使用垂直分割。如果你
要水平分割，加上  <a href="starting.html#-o">-o</a>  參數: 
<code class="example"></code>
<code class="example">        vimdiff -o file1 file2 [file3 [file4]]</code>
<code class="example"></code>
如果你喜歡總使用水平分割，在 <a href="options.html#'diffopt'">'diffopt'</a> 裡包含 "horizontal"。

在每一個被編輯的文件中，以下選項被設定:

        <a href="options.html#'diff'">'diff'</a>          打開
        <a href="options.html#'scrollbind'">'scrollbind'</a>    打開
        <a href="options.html#'cursorbind'">'cursorbind'</a>    打開
        <a href="options.html#'scrollopt'">'scrollopt'</a>     包含 "hor"
        <a href="options.html#'wrap'">'wrap'</a>          關閉
        <a href="options.html#'foldmethod'">'foldmethod'</a>    "diff"
        <a href="options.html#'foldcolumn'">'foldcolumn'</a>    來自 <a href="options.html#'diffopt'">'diffopt'</a> 的值，缺省為 2

這些參數僅設置於當前窗口。當編輯其它文件時，以上選項被重設回全局值。
不過，重新編輯文件時，仍然可以用模式行修改這些參數。但 <a href="options.html#'diff'">'diff'</a> 置位時，
<a href="options.html#'foldmethod'">'foldmethod'</a> 和 <a href="options.html#'wrap'">'wrap'</a> 不受模式行改變。

比較基於緩衝區的內容。因而，如果在載入文件後你做過改動，這些改動也將參加比較。
不過，你也許要不時地使用 "diffupdate"。因為並非所有的改動的結果都能自動更新。

在 .vimrc 文件中，你可以用以下的結構，對比較模式做專門的設定: 
<code class="example"></code>
<code class="example">        if &amp;diff</code>
<code class="example">           setup for diff mode</code>
<code class="example">        else</code>
<code class="example">           setup for non-diff mode</code>
<code class="example">        endif</code>
<code class="example"></code>
如果已在 Vim 中，你可以用三種方式進入比較模式。

                                                        <b class="vimtag"> <a name="E98">E98</a> </b>
:diffs[plit] <code class="special">{filename}</code>                                 <b class="vimtag"> <a name=":diffs">:diffs</a> </b> <b class="vimtag"> <a name=":diffsplit">:diffsplit</a> </b>
                對 <code class="special">{filename}</code> 開一個新窗口。當前的和新開的窗口將設定和
                "vimdiff" 一樣的參數。另見 <a href="options.html#'diffexpr'">'diffexpr'</a>。

                                                        <b class="vimtag"> <a name=":difft">:difft</a> </b> <b class="vimtag"> <a name=":diffthis">:diffthis</a> </b>
:difft[his]     使當前窗口參與比較。本命令設定和 "vimdiff" 同樣的選項。

:diffp[atch] <code class="special">{patchfile}</code>                         <b class="vimtag"> <a name="E816">E816</a> </b> <b class="vimtag"> <a name=":diffp">:diffp</a> </b> <b class="vimtag"> <a name=":diffpatch">:diffpatch</a> </b>
                使用當前的緩衝區，用 <code class="special">{patchfile}</code> 給它打上補丁並打開一個緩衝區
                顯示結果。兩個緩衝區都將設定為和 "vimdiff" 同樣的參數。
                <code class="special">{patchfile}</code> 可以是任何一種 "patch" 程序認識的或 <a href="options.html#'patchexpr'">'patchexpr'</a> 可
                以處理的格式。
                <code class="note">注意</code>: <code class="special">{patchfile}</code> 只能包含一個文件的比較結果: 當前文件。如果
                <code class="special">{patchfile}</code> 也包含了其他文件的比較，結果將不可預知。Vim 改變當
                前目錄到 /tmp， 以避免當前目錄下的文件被意外的打補丁。但它仍不
                能避免若干 ".rej" 文件產生。當絕對路徑名出現時，這些文件也不能
                避免被打補丁。

要垂直分割窗口，在前面加上  <a href="windows.html#:vertical">:vertical</a> 。例如: 
<code class="example"></code>
<code class="example">        :vert diffsplit main.c~</code>
<code class="example">        :vert diffpatch /tmp/diff</code>
<code class="example"></code>
如果你偏好垂直分割，可以在 <a href="options.html#'diffopt'">'diffopt'</a> 中包含 "vertical"。

                                                        <b class="vimtag"> <a name="E96">E96</a> </b>
最多可以對八個緩衝區設置 <a href="options.html#'diff'">'diff'</a> 模式。

因為選項的值是由緩衝區記錄的，在編輯另一個文件後又回到此文件時，你仍會處於比較
模式。

                                                        <b class="vimtag"> <a name=":diffo">:diffo</a> </b> <b class="vimtag"> <a name=":diffoff">:diffoff</a> </b>
:diffo[ff]      為當前窗口關閉比較模式。即使 <a href="options.html#'diff'">'diff'</a> 沒有置位，也復位相關選項。

:diffo[ff]!     為當前窗口和當前標籤頁所有置位 <a href="options.html#'diff'">'diff'</a> 的窗口關閉比較模式。只在
                在置位 <a href="options.html#'diff'">'diff'</a> 的窗口中才復位相關選項，如果當前窗口沒有置位
                <a href="options.html#'diff'">'diff'</a>，不改變其任何選項。
                隱藏緩衝區也從參於比較的緩衝區列表中刪除。

 <a href="diff.html#:diffoff">:diffoff</a>  命令復位相關選項到啟用  <a href="diff.html#:diffsplit">:diffsplit</a> ， <a href="diff.html#:diffpatch">:diffpatch</a> ， <a href="diff.html#:diffthis">:diffthis</a>  之
前或以比較模式啟動 Vim 時的值。
使用  <a href="diff.html#:diffoff">:diffoff</a>  兩次恢復再上次的保存值。
否則復位其默認值如下:

        <a href="options.html#'diff'">'diff'</a>          關閉
        <a href="options.html#'scrollbind'">'scrollbind'</a>    關閉
        <a href="options.html#'cursorbind'">'cursorbind'</a>    關閉
        <a href="options.html#'scrollopt'">'scrollopt'</a>     沒有 "hor"
        <a href="options.html#'wrap'">'wrap'</a>          打開
        <a href="options.html#'foldmethod'">'foldmethod'</a>    "manual"
        <a href="options.html#'foldcolumn'">'foldcolumn'</a>    0

</pre><hr class="doubleline" /><pre>
<h4>2. 查看比較結果                                         <b class="vimtag"> <a name="view-diffs">view-diffs</a> </b></h4>
比較產生的結果是，不同比較窗口顯示同一文件不同版本，高亮標出差異的部分。當滾動
文本時，<a href="options.html#'scrollbind'">'scrollbind'</a> 選項將使得另一窗口的相應文本也隨著滾動。垂直分割時，文本
會恰當地對齊。

不過，以下情況將使文本對齊出現問題:
- 當設置了 <a href="options.html#'wrap'">'wrap'</a> 後，一些行將被自動換行，在屏幕上佔用兩行以上。
- 一個緩衝區打開了折疊，另一個卻沒有。
- <a href="options.html#'scrollbind'">'scrollbind'</a> 被關閉
- 文本做過改動
- <a href="options.html#'diffopt'">'diffopt'</a> 中沒有 "filler"，插入或刪除的行會使對齊出錯

所有打開 <a href="options.html#'diff'">'diff'</a> 選項並在某一個窗口編輯的緩衝區都將參與比較。即使對於一個隱藏的
緩衝區也是如此，如果它曾在一個窗口內被編輯過的話。要去除隱藏緩衝區，用
 <code class="badlink">:diffoff!</code> 。

                                        <b class="vimtag"> <a name=":DiffOrig">:DiffOrig</a> </b> <b class="vimtag"> <a name="diff-original-file">diff-original-file</a> </b>
因為 <a href="options.html#'diff'">'diff'</a> 是一個局部於窗口的選項，所以同一緩衝區可以在某一個窗口裡是比較模
式，而在另一個窗口裡則是普通模式。你也可能想查看對一緩衝區在讀入文件後所做過的
改動。既然 Vim 不允許同一個文件有 2 個緩衝區，你需要另一個緩衝區。可用下面的命
令: 
<code class="example">         command DiffOrig vert new | set bt=nofile | r ++edit # | 0d_</code>
<code class="example">                \ | diffthis | wincmd p | diffthis</code>
( <a href="usr_05.html#vimrc_example.vim">vimrc_example.vim</a>  裡有該示例)。之後，使用 ":DiffOrig" 就可以查看當前緩衝區
和它剛從文件裡載入時的不同之處。

要 <code class="note">注意</code>: 已經卸載的緩衝區不能參與比較。但一個隱藏的緩衝區是可以的。你可以使用
":hide" 來關閉但不卸載窗口。如果你不想緩衝區繼續參與比較，可以在隱藏前先執行
":set nodiff"。

                                                        <b class="vimtag"> <a name=":dif">:dif</a> </b> <b class="vimtag"> <a name=":diffupdate">:diffupdate</a> </b>
:dif[fupdate][!]                刷新比較結果的高亮和折疊。

在改變文本時，Vim 試圖更新比較的結果。插入或刪除行一般會得到正確的更新。但行內
或者更複雜的改動將無法如此。要強制刷新比較結果，使用: 
<code class="example"></code>
<code class="example">        :diffupdate</code>
<code class="example"></code>
包含 ! 時，Vim 會檢查文件是否被外部改變而需要重新載入。對每個被改變的文件給出
提示，就像用了  <a href="editing.html#:checktime">:checktime</a>  那樣。

一些行在本窗口沒有，但卻在一個窗口裡出現。它們或者是在那個文件裡新插入的，或者
是在本文件裡剛刪除的。對這些行，除非 <a href="options.html#'diffopt'">'diffopt'</a> 選項中不包含 "filler"，Vim 將在
本窗口對應的位置顯示填充行。


折疊可以用來隱藏那些沒有被更改過的文字。要知道所有用於折疊的命令，可以參考
 <a href="fold.html#folding">folding</a> 。

<a href="options.html#'diffopt'">'diffopt'</a> 選項還可以用來設置在差異文之前不被折疊的行數 (上下文)。如要把上下文
設為 3 行: 
<code class="example"></code>
<code class="example">        :set diffopt=filler,context:3</code>
<code class="example"></code>
<code class="example"></code>
以下的語法高亮群組可以用來顯示比較的結果:

 <a href="syntax.html#hl-DiffAdd">hl-DiffAdd</a>     DiffAdd         添加 (插入) 的行。這些行只存在於本緩衝區裡。
 <a href="syntax.html#hl-DiffChange">hl-DiffChange</a>  DiffChange      改動過的行。
 <a href="syntax.html#hl-DiffText">hl-DiffText</a>    DiffText        在改動行中被更改的文本。Vim 找到第一個和最後一
                                個不同的字符 (從行末開始搜起) 之間的文字，包括
                                其實沒被改動的部分，都被高亮。這裡只受到
                                <a href="options.html#'diffopt'">'diffopt'</a> 中的 "iwhite" 的影響。
 <a href="syntax.html#hl-DiffDelete">hl-DiffDelete</a>  DiffDelete      被刪除的行。也稱為填充行，因為在本緩衝區裡這些
                                行並不真正存在。

</pre><hr class="doubleline" /><pre>
<h4>3. 跳轉到差異文                                         <b class="vimtag"> <a name="jumpto-diffs">jumpto-diffs</a> </b></h4>
有兩條命令可用於在跳轉到差異文所在的位置:
                                                                <b class="vimtag"> <a name="[c">[c</a> </b>
        [c              反向跳轉至上一處更改的開始。計數前綴使之重複執行相應
                        次。
                                                                <b class="vimtag"> <a name="]c">]c</a> </b>
        ]c              正向跳轉至下一個更改的開始。計數前綴使之重複執行相應
                        次。

如果不存在光標可以跳轉到的更改，將產生錯誤。

</pre><hr class="doubleline" /><pre>
<h4>4. 複製差異文本                 <b class="vimtag"> <a name="copy-diffs">copy-diffs</a> </b> <b class="vimtag"> <a name="E99">E99</a> </b> <b class="vimtag"> <a name="E100">E100</a> </b> <b class="vimtag"> <a name="E101">E101</a> </b> <b class="vimtag"> <a name="E102">E102</a> </b> <b class="vimtag"> <a name="E103">E103</a> </b></h4>                                                                <b class="vimtag"> <a name="merge">merge</a> </b>
有兩個命令可用來在兩個緩衝區之間複製文本。相應的結果是，在一定的範圍內兩緩衝區
的內容被統一。

                                                        <b class="vimtag"> <a name=":diffg">:diffg</a> </b> <b class="vimtag"> <a name=":diffget">:diffget</a> </b>
:<code class="special">[range]</code>diffg[et] <code class="special">[bufspec]</code>
                用另一個緩衝區來修改當前的緩衝區，消除不同之處。除非只有另外一
                個比較模式下的緩衝區， <code class="special">[bufspec]</code> 必須存在並指定那個緩衝區。
                如果 <code class="special">[bufspec]</code> 指定的是當前緩衝區，則為空動作。
                <code class="special">[range]</code> 可以參考下面。

                                                <b class="vimtag"> <a name=":diffpu">:diffpu</a> </b> <b class="vimtag"> <a name=":diffput">:diffput</a> </b> <b class="vimtag"> <a name="E793">E793</a> </b>
:<code class="special">[range]</code>diffpu[t] <code class="special">[bufspec]</code>
                用當前緩衝區來修改另一個緩衝區，消除不同之處。不同於
                ":diffget" 之處僅在於被更改的是另一個緩衝區。
                如果忽略 <code class="special">[bufspec]</code>，而多於一個緩衝區處於比較模式並置位
                <a href="options.html#'modifiable'">'modifiable'</a> 的話，此命令失敗。
                <code class="special">[range]</code> 可以參考下面。

                                                        <b class="vimtag"> <a name="do">do</a> </b>
<code class="special">[count]</code>do       同 ":diffget"，但沒有範圍。"o" 表示 "obtain" (不能用
                "dg"，因為那可能是 "dgg" 的開始！)。<code class="note">注意</code> 不適用於可視模式。
                給出的 <code class="special">[count]</code> 用作 ":diffget" 的 <code class="special">[bufspec]</code> 參數。

                                                        <b class="vimtag"> <a name="dp">dp</a> </b>
dp              同 ":diffput"，但沒有範圍。<code class="note">注意</code> 不適用於可視模式。
                給出的 <code class="special">[count]</code> 用作 ":diffput" 的 <code class="special">[bufspec]</code> 參數。

當沒有給定 <code class="special">[range]</code> 時，受影響的僅是當前光標所處位置或其緊上方的差異文本。
當指定 <code class="special">[range]</code> 時，Vim 試圖僅改動它指定的行。不過，當有被刪除的行時，這不總有
效。

可能在最後一行之後有刪除的行。要從另一個緩衝區中取得那些行，可使用最後一行的行
號加一來實現。以下命令從另一個緩衝區中得到所有的差異文本: 
<code class="example"></code>
<code class="example">        :1,$+1diffget</code>
<code class="example"></code>
<code class="note">注意</code>: 被刪除的行會被顯示，但不作為文本行看待。你也不能將光標移至其中。要用另一
個緩衝區來填充被刪除的行，可在其下一行用 ":diffget"。
                                                                <b class="vimtag"> <a name="E787">E787</a> </b>
如果要修改的緩衝區只讀，而  <a href="autocmd.html#FileChangedRO">FileChangedRO</a>  激活的自動命令要修改緩衝區，該命令
會失敗。此時，自動命令不能修改緩衝區。

參數 <code class="special">[bufspec]</code> 可以是緩衝區的序號，匹配緩衝區名稱或緩衝區名稱的一部分的模式。
例如:

        :diffget                使用另一個進入比較模式的緩衝區
        :diffget 3              使用 3 號緩衝區
        :diffget v2             使用名字同 "v2" 匹配的緩衝區，並進入比較模式
                                (例如，"file.c.v2")

</pre><hr class="doubleline" /><pre>
<h4>5. diff 選項                                            <b class="vimtag"> <a name="diff-options">diff-options</a> </b></h4>
也可參考  <a href="options.html#'diffopt'">'diffopt'</a>  和  <a href="options.html#'fillchars'">'fillchars'</a>  中的 "diff" 項。

                                            <b class="vimtag"> <a name="diff-slow">diff-slow</a> </b> <b class="vimtag"> <a name="diff_translations">diff_translations</a> </b>
比較語法高亮對很長的行可能會較慢，尤其是因為它試圖匹配各種本地化的文本。要關閉
本地化並提高語法高亮速度，設置全局變量 g:diff_translations 為零: 
<code class="example"></code>
<code class="example">    let g:diff_translations = 0</code>

設置此變量後，重新載入語法腳本: 
<code class="example"></code>
<code class="example">    set syntax=diff</code>



查 找 不 同                                             <b class="vimtag"> <a name="diff-diffexpr">diff-diffexpr</a> </b>

 <a href="options.html#'diffexpr'">'diffexpr'</a> 選項可以用來設定非標準的 "diff" 程序，用來比較文件間的異同。

當 <a href="options.html#'diffexpr'">'diffexpr'</a> 為空的時候，Vim 使用以下命令在 file1 和 file2 中查找不同之處: 
<code class="example"></code>
<code class="example">        diff file1 file2 &gt; outfile</code>
<code class="example"></code>
其中的 "&gt;" 應當用 <a href="options.html#'shellredir'">'shellredir'</a> 的值替換。

"diff" 的輸出必須是普通的 "ed" 風格的 diff。 <code class="emphasis">不要</code>  使用上下文 (context) 風格的
diff。下面就是一個 Vim 所期望格式的範例: 
<code class="example"></code>
<code class="example">        1a2</code>
<code class="example">        &gt; bbb</code>
<code class="example">        4d4</code>
<code class="example">        &lt; 111</code>
<code class="example">        7c7</code>
<code class="example">        &lt; GGG</code>
</pre><hr class="singleline" /><pre>
        &gt; ggg

"1a2" 項添加了 "bbb" 行。
"4d4" 項刪除了 "111" 行。
"7c7" 項用 "ggg" 行替代了 "GGG" 行。

當 <a href="options.html#'diffexpr'">'diffexpr'</a> 不為空時，Vim 執行它以得到一個滿足上述格式的 diff 文件。在執行過
程中，以下的變量會被設置為須用到的文件名:

        v:fname_in              原始文件
        v:fname_new             同一文件的新版
        v:fname_out             產生的 diff 文件

另外，<a href="options.html#'diffexpr'">'diffexpr'</a> 應負責實現 <a href="options.html#'diffopt'">'diffopt'</a> 選項中的 "icase" 和 "iwhite" 。
而且，<a href="options.html#'diffexpr'">'diffexpr'</a> 不能更改 <a href="options.html#'lines'">'lines'</a> 和 <a href="options.html#'columns'">'columns'</a> 的值。

示例 (大致相當於 <a href="options.html#'diffexpr'">'diffexpr'</a> 為空時的行為): 
<code class="example"></code>
<code class="example">        set diffexpr=MyDiff()</code>
<code class="example">        function MyDiff()</code>
<code class="example">           let opt = ""</code>
<code class="example">           if &amp;diffopt =~ "icase"</code>
<code class="example">             let opt = opt . "-i "</code>
<code class="example">           endif</code>
<code class="example">           if &amp;diffopt =~ "iwhite"</code>
<code class="example">             let opt = opt . "-b "</code>
<code class="example">           endif</code>
<code class="example">           silent execute "!diff -a --binary " . opt . v:fname_in . " " . v:fname_new .</code>
<code class="example">                \  " &gt; " . v:fname_out</code>
<code class="example">        endfunction</code>


其中，"-a" 參數被用來強制將文件作為文本來比較，二進制的比較沒有什麼意義。
"--binary" 參數使得文件以二進制模式讀入，這樣在 DOS 上 <code class="keystroke">CTRL-Z</code> 就不會結束文本。


                                                <b class="vimtag"> <a name="E810">E810</a> </b> <b class="vimtag"> <a name="E97">E97</a> </b>
Vim 將測試 diff 的輸出看上去是否完全正確。如果不正確，你將得到一個錯誤信息。可
能是因為:
-  "diff" 程序無法執行。
-  "diff" 程序無法產生普通 "ed" 風格的 diff 文件 (參考上面)。
-  <a href="options.html#'shell'">'shell'</a> 和相關選項沒有正確設置。試試類似 ":!sort" 過濾運行是否正確。
-  你設置的 <a href="options.html#'diffexpr'">'diffexpr'</a> 可能不正確。
如果問題出在哪裡不是很清楚，可以設置 <a href="options.html#'verbose'">'verbose'</a> 選項為一或更高的值，以獲得更多
的信息。

MS-Windows 自安裝的 Vim 包含了 diff 程序。如果沒有，您可以自行下載 diff.exe。
例如從這裡
http://gnuwin32.sourceforge.net/packages/diffutils.htm。


使 用 補 丁                                     <b class="vimtag"> <a name="diff-patchexpr">diff-patchexpr</a> </b>

選項 <a href="options.html#'patchexpr'">'patchexpr'</a> 可以用來設定非標準的 "patch" 程序。

當 <a href="options.html#'patchexpr'">'patchexpr'</a> 為空時，Vim 將這樣調用 "patch" 程序: 
<code class="example"></code>
<code class="example">        patch -o outfile origfile &lt; patchfile</code>
<code class="example"></code>
對於大多數的 "patch" 程序版本，這都可以正確工作。 <code class="note">注意</code>: 在一行中間的 CR 可能產
生問題。它被當做一個換行符。

如果默認值無法使工作，設定 <a href="options.html#'patchexpr'">'patchexpr'</a> 使之有以上所述的同樣的效果。它被執行
時，以下的變量會被設定為相關的文件名:

        v:fname_in              原始文件
        v:fname_diff            補丁文件
        v:fname_out             要生成的打過補丁的文件

示例 (對應 <a href="options.html#'patchexpr'">'patchexpr'</a> 為空時的行為): 
<code class="example"></code>
<code class="example">        set patchexpr=MyPatch()</code>
<code class="example">        function MyPatch()</code>
<code class="example">           :call system("patch -o " . v:fname_out . " " . v:fname_in .</code>
<code class="example">           \  " &lt; " . v:fname_diff)</code>
<code class="example">        endfunction</code>
<code class="example"></code>
請確定使用 "patch" 程序時不會有不想要的副作用。比如，要留心那些生成的額外的文
件，用完之後應該將其刪除。該程序應該僅僅給文件打補丁而沒有別的作用。

使用 <a href="options.html#'patchexpr'">'patchexpr'</a> 的值之前， Vim 將改變當前目錄到 "/tmp" 或別的臨時目錄。這是為
了讓當前目錄下的文件不被意外的打補丁。Vim 也將刪除以 v:fname_in 開始以 ".rej"
和 ".orig" 結尾的文件。

 vim:tw=78:ts=8:ft=help:norl:
</pre>
<p><i>Generated by vim2html</i></p>
</div>
</body>
</html>
